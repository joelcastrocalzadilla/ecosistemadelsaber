<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Practicando s√≠labas con emojis</title>
<style>
  body { font-family: sans-serif; text-align: center; background: #e3f2fd; }
  input, button { font-size: 1.5em; margin: 10px; padding: 10px; border-radius: 8px; }
  #silabaMostrada { font-size: 5em; margin-top: 20px; transition: transform 0.5s, color 0.5s; }
  #imagenes { font-size: 3em; margin-top: 10px; }
  #saludo { font-size: 1.2em; margin-top: 10px; color: #333; }
  .animar {
    color: #d32f2f;
    transform: scale(1.3);
    animation: parpadeo 1s ease-in-out 2;
  }
  @keyframes parpadeo {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.2; }
  }
</style>
</head>
<body>
  <h1>Practicando s√≠labas con emojis</h1>
  <input id="nombre" placeholder="Tu nombre">
  <button onclick="iniciar()">Comenzar</button>
  <button onclick="repetirSilaba()">üîÅ Repetir</button>
  <div id="saludo"></div>
  <input id="entrada" maxlength="3" placeholder="pa" oninput="decirSilaba()">
  <div id="silabaMostrada"></div>
  <div id="imagenes"></div>

<script>
let voces = [];
let nombreNi√±o = "ni√±o";
let timerInactividad;
let ultimaSilaba = "";

const ejemplos = {
  "pa":[["pato","ü¶Ü"],["papa","ü•î"],["paleta","üç≠"]],
  "pe":[["pera","üçê"],["pelota","‚öΩ"],["perro","üê∂"]],
  "pi":[["pino","üå≤"],["piedra","ü™®"],["pintura","üé®"]],
  "po":[["pollo","üêî"],["polo","üç≠"],["port√≥n","üö™"]],
  "pu":[["pulpo","üêô"],["puma","üêÜ"],["pupusa","ü•ü"]]
};

function cargarVoces() {
  voces = speechSynthesis.getVoices();
  if (voces.length === 0) setTimeout(cargarVoces, 500);
}
speechSynthesis.onvoiceschanged = cargarVoces;
cargarVoces();

function hablar(texto){
  if (voces.length === 0) voces = speechSynthesis.getVoices();
  let utter = new SpeechSynthesisUtterance(texto);
  utter.lang = "es-ES";
  utter.rate = 0.8;
  let voz = voces.find(v => v.lang.startsWith("es"));
  if (voz) utter.voice = voz;
  speechSynthesis.cancel();
  speechSynthesis.speak(utter);
}

function iniciar(){
  let nombreIngresado = document.getElementById("nombre").value.trim();
  if(nombreIngresado) nombreNi√±o = nombreIngresado;
  let mensaje = `¬°Hola, hola ${nombreNi√±o}! üëãüòÄ ¬°Qu√© alegr√≠a tenerte aqu√≠! Vamos a jugar con las s√≠labas, escribe una para comenzar.`;
  document.getElementById("saludo").textContent = mensaje;
  hablar(mensaje);
  reiniciarTimer();
}

function reiniciarTimer(){
  clearTimeout(timerInactividad);
  timerInactividad = setTimeout(()=>{
    let mensaje = `¬°Ey ${nombreNi√±o}! ¬øQu√© pasa? Sigamos practicando, cambia la s√≠laba...`;
    document.getElementById("saludo").textContent = mensaje;
    hablar(mensaje);
  }, 20000);
}

function animarSilaba(){
  let elem = document.getElementById("silabaMostrada");
  elem.classList.add("animar");
  setTimeout(()=> elem.classList.remove("animar"), 1500);
}

function decirSilaba(){
  reiniciarTimer();
  let silaba = document.getElementById("entrada").value.toLowerCase();
  if(!silaba.match(/^[a-z√±]{1,3}$/i)) return;

  // Validaciones pedag√≥gicas
  if(silaba.length === 1){
    hablar(`Eso no es una s√≠laba, ${nombreNi√±o}. Debes poner una consonante y una vocal.`);
    return;
  }
  if(silaba.length === 2){
    let c1 = silaba.charAt(0);
    let c2 = silaba.charAt(1);
    let vocales = "aeiou";
    if((vocales.includes(c1) && vocales.includes(c2))){
      hablar(`Eso no es una s√≠laba, ${nombreNi√±o}. No se pueden poner dos vocales seguidas. Intenta con consonante m√°s vocal.`);
      return;
    }
    if(!vocales.includes(c1) && !vocales.includes(c2)){
      hablar(`Eso no es una s√≠laba, ${nombreNi√±o}. No se pueden poner dos consonantes seguidas. Intenta con consonante m√°s vocal.`);
      return;
    }
  }

  ultimaSilaba = silaba;
  document.getElementById("silabaMostrada").textContent = silaba.toUpperCase();
  animarSilaba();

  let lista = ejemplos[silaba] || [];
  if(lista.length === 0){
    hablar(`Lo siento ${nombreNi√±o}, no tengo ejemplos para la s√≠laba ${silaba}. Intenta con otra.`);
    document.getElementById("imagenes").innerHTML = "";
    return;
  }

  let letra = silaba.charAt(0);
  let vocal = silaba.charAt(1) || "";
  let explicacion = `Escucha bien por favor... la letra "${letra}" con la "${vocal}" se lee "${silaba}". Repito: "${silaba}".`;
  let ejemplosTexto = `${silaba} de ${lista.map(p => p[0]).join(", ")}. ¬°Muy bien ${nombreNi√±o}!`;

  hablar(explicacion + " " + ejemplosTexto);
  document.getElementById("imagenes").innerHTML = lista.map(p => p[1]).join(" ");
}

function repetirSilaba(){
  if(!ultimaSilaba) return;

  let lista = ejemplos[ultimaSilaba] || [];
  if(lista.length === 0){
    hablar(`Lo siento ${nombreNi√±o}, no tengo ejemplos para la s√≠laba ${ultimaSilaba}.`);
    return;
  }

  let letra = ultimaSilaba.charAt(0);
  let vocal = ultimaSilaba.charAt(1) || "";
  let explicacion = `Escucha bien por favor... la letra "${letra}" con la "${vocal}" se lee "${ultimaSilaba}". Repito: "${ultimaSilaba}".`;
  let ejemplosTexto = `${ultimaSilaba} de ${lista.map(p => p[0]).join(", ")}. ¬°Muy bien ${nombreNi√±o}!`;

  hablar(explicacion + " " + ejemplosTexto);
  document.getElementById("imagenes").innerHTML = lista.map(p => p[1]).join(" ");
  animarSilaba();
}
</script>
</body>
</html>
