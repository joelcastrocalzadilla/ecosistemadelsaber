<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Resta divertida con ositos, globo y piano</title>
<style>
  body { font-family: sans-serif; text-align: center; margin: 0; padding: 0; }
  .pantalla { display: none; padding: 20px; }
  #inicio { display: block; }
  .grupo { font-size: 2em; margin: 20px; min-height: 50px; }
  #globo {
    width: 120px; height: 120px;
    border-radius: 50%;
    background: orange;
    margin: 20px auto;
    transition: all 0.5s ease;
    display: flex; align-items: center; justify-content: center;
    font-size: 2.5em; color: white;
  }
  .globo-con-numero {
    display: flex; flex-direction: column; align-items: center; gap: 10px;
  }
  #numeroGlobo {
    font-size: 2.5em; font-weight: bold; color: #333;
  }
  #resultado { margin-top: 20px; font-size: 1.5em; }
  .cuenta {
    font-size: 2.5em;
    line-height: 1.2;
    display: inline-block;
    text-align: right;
    margin-top: 20px;
  }
  .linea {
    border-top: 3px solid black;
    margin-top: 5px;
  }
</style>
</head>
<body id="fondo">

<!-- Pantalla inicial -->
<div id="inicio" class="pantalla">
  <h1>Bienvenido a la resta divertida</h1>
  <p>Escribe tu nombre y selecciona:</p>
  <input id="nombre" placeholder="Tu nombre">
  <select id="genero">
    <option value="azul">NiÃ±o ðŸ‘¦</option>
    <option value="rosado">NiÃ±a ðŸ‘§</option>
  </select><br><br>
  <button onclick="empezar()">Comenzar</button>
</div>

<!-- Pantalla del juego -->
<div id="juego" class="pantalla">
  <h2 id="saludo"></h2>
  <p id="instrucciones"></p>
  <input id="num1" type="number" placeholder="Ej: 9"> âˆ’
  <input id="num2" type="number" placeholder="Ej: 4">
  <button onclick="iniciarResta()">Restar</button>

  <div>
    <h3>Grupo inicial</h3>
    <div id="grupo" class="grupo"></div>
  </div>

  <div class="globo-con-numero">
    <div id="globo">ðŸŽˆ</div>
    <div id="numeroGlobo">0</div>
  </div>

  <h2 id="resultado"></h2>
  <div id="cuentaFinal"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
<script>
// --- VOZ DE LA ABUELITA ---
function hablar(texto){
  let utter = new SpeechSynthesisUtterance(texto);
  utter.lang = "es-ES";
  utter.rate = 0.9;
  speechSynthesis.cancel();
  speechSynthesis.speak(utter);
}

// Pantalla inicial y fondo personalizado
function empezar(){
  const nombre = document.getElementById("nombre").value;
  const genero = document.getElementById("genero").value;
  document.getElementById("inicio").style.display="none";
  document.getElementById("juego").style.display="block";
  document.getElementById("saludo").textContent = "Hola " + nombre + ", Â¡vamos a restar y divertirnos!";
  document.body.style.background = (genero==="azul") ? "#cce5ff" : "#ffd6e7";

  // Instrucciones claras
  let instrucciones = "Vas a escribir dos nÃºmeros: el primero serÃ¡ el minuendo, el nÃºmero grande del que vamos a quitar. El segundo serÃ¡ el sustraendo, el nÃºmero que vamos a restar. Luego oprime el botÃ³n RESTAR para continuar.";
  document.getElementById("instrucciones").textContent = instrucciones;

  // Saludo efusivo con voz
  hablar(`Hola ${nombre}! QuÃ© alegrÃ­a verte. Hoy vamos a jugar con la resta. 
  Vas a escribir dos nÃºmeros: el primero es el minuendo, el nÃºmero grande. 
  El segundo es el sustraendo, el nÃºmero que vamos a quitar. 
  Cuando los escribas, oprime el botÃ³n Restar para continuar.`);
}

// Dibujar ositos
function dibujarOsitos(cantidad){
  return "ðŸ§¸".repeat(Math.max(0, cantidad));
}

// Sonidos de piano (descendentes)
function playNote(frequency, duration=0.35){
  const ctx = new (window.AudioContext || window.webkitAudioContext)();
  const osc = ctx.createOscillator();
  const gain = ctx.createGain();
  osc.type = "sine";
  osc.frequency.value = frequency;
  osc.connect(gain);
  gain.connect(ctx.destination);
  osc.start();
  gain.gain.setValueAtTime(0.22, ctx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration);
  osc.stop(ctx.currentTime + duration);
}
const escalaDesc = [392.00, 349.23, 329.63, 293.66, 261.63]; // G F E D C
let pasoMusical = 0;
function playStepSound(){
  playNote(escalaDesc[pasoMusical % escalaDesc.length]);
  pasoMusical++;
}
function playFinalChord(){
  playNote(261.63, 0.9); // C
  playNote(329.63, 0.9); // E
  playNote(392.00, 0.9); // G
}
  // Juego de resta
function iniciarResta(){
  let minuendo = parseInt(document.getElementById("num1").value);
  let sustraendo = parseInt(document.getElementById("num2").value);

  // ValidaciÃ³n
  if(isNaN(minuendo)||isNaN(sustraendo)){
    hablar("Debes escribir dos nÃºmeros para poder restar.");
    return;
  }
  if(sustraendo > minuendo){
    hablar("Recuerda: el sustraendo no puede ser mayor que el minuendo. Escribe de nuevo los nÃºmeros.");
    return;
  }

  let a = minuendo;
  let b = sustraendo;
  let diferencia = a - b;

  let grupoDiv = document.getElementById("grupo");
  let resultado = document.getElementById("resultado");
  let globo = document.getElementById("globo");
  let numeroGlobo = document.getElementById("numeroGlobo");
  let cuentaFinal = document.getElementById("cuentaFinal");

  grupoDiv.textContent = "";
  resultado.textContent = "";
  cuentaFinal.innerHTML = "";
  globo.style.width="120px"; globo.style.height="120px";
  globo.textContent="ðŸŽˆ";
  globo.style.background="orange";
  numeroGlobo.textContent = a;
  pasoMusical = 0;

  // ðŸ‘‰ Si la diferencia es mayor de 10, solo mostramos el resultado final
  if(diferencia > 10){
    resultado.textContent = `Resultado: ${diferencia}`;
    confetti({ particleCount: 160, spread: 70, origin: { y: 0.6 } });
    globo.style.background="transparent";
    globo.textContent="ðŸ’¥";
    playFinalChord();

    cuentaFinal.innerHTML = `
      <div class="cuenta">
        ${a}<br>
        âˆ’ ${b}<br>
        <div class="linea"></div>
        ${diferencia}
      </div>
    `;

    hablar(`Muy bien. TenÃ­as ${a} caramelos y regalaste ${b} a la abuelita. 
    Te quedan ${diferencia}. Como es una resta grande, fuimos directo al resultado. 
       Ahora escribe nuevamente dos nÃºmeros y oprime el botÃ³n Restar para continuar, 
    y asÃ­ seguiremos practicando hasta el infinito y mÃ¡s allÃ¡.`);
    return;
  }

  // ðŸ‘‰ Si la diferencia es 10 o menos, hacemos la animaciÃ³n paso a paso
  hablar(`Muy bien. Tienes ${a} caramelos. 
  Si le regalas ${b} a la abuelita, Â¿cuÃ¡ntos te quedan? Vamos a verlo paso a paso...`);

  let pasos = b;
  let total = a;
  let intervalo = setInterval(()=>{
    if(pasos>0){
      pasos--;
      total = Math.max(0, total-1);
      grupoDiv.textContent = dibujarOsitos(total);

      // achicar globo
      let progreso = (b - pasos);
      let size = 120 - progreso*20;
      globo.style.width=Math.max(60, size)+"px";
      globo.style.height=Math.max(60, size)+"px";

      numeroGlobo.textContent = total;
      playStepSound();

      hablar(`Ahora te quedan ${total} caramelos.`);
    } else {
      clearInterval(intervalo);
      resultado.textContent = `Resultado: ${diferencia}`;
      confetti({ particleCount: 160, spread: 70, origin: { y: 0.6 } });
      globo.style.background="transparent";
      globo.textContent="ðŸ’¥";
      playFinalChord();

      cuentaFinal.innerHTML = `
        <div class="cuenta">
          ${a}<br>
          âˆ’ ${b}<br>
          <div class="linea"></div>
          ${diferencia}
        </div>
      `;

      hablar(`Â¡Muy bien! TenÃ­as ${a} caramelos y regalaste ${b} a la abuelita. 
      Te quedan ${diferencia}. Excelente trabajo, vamos a seguir practicando. 
      Ahora escribe nuevamente dos nÃºmeros y oprime el botÃ³n Restar para continuar, 
      y asÃ­ seguiremos jugando hasta el infinito y mÃ¡s allÃ¡.`);
    }
  }, 3000); // ðŸ‘ˆ 3 segundos entre cada paso
}
</script>
</body>
</html>




