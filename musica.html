<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Suma divertida con ositos, globo y piano</title>
  <style>
    body { font-family: sans-serif; text-align: center; margin: 0; padding: 0; }
    .pantalla { display: none; padding: 20px; }
    #inicio { display: block; }
    .grupo { font-size: 2em; margin: 20px; min-height: 50px; }
    .contenedor { display: flex; justify-content: center; gap: 50px; }
    #globo {
      width: 100px; height: 100px;
      border-radius: 50%;
      background: red;
      margin: 20px auto;
      transition: all 0.5s ease;
      display: flex; align-items: center; justify-content: center;
      font-size: 2.5em; color: white;
    }
    .globo-con-numero {
      display: flex; flex-direction: column; align-items: center; gap: 10px;
    }
    #numeroGlobo {
      font-size: 2.5em; font-weight: bold; color: #333;
    }
    #resultado { margin-top: 20px; font-size: 1.5em; }
    .cuenta {
      font-size: 2.5em;
      line-height: 1.2;
      display: inline-block;
      text-align: right;
      margin-top: 20px;
    }
    .linea {
      border-top: 3px solid black;
      margin-top: 5px;
    }
    .medalla {
      font-size: 4em;
      margin-top: 20px;
      animation: brillar 2s ease-in-out infinite alternate;
    }
    @keyframes brillar {
      from { opacity: 0.5; transform: scale(1); }
      to { opacity: 1; transform: scale(1.2); }
    }
  </style>
</head>
<body id="fondo">

<div id="inicio" class="pantalla">
  <h1>Bienvenido a la suma divertida</h1>
  <p>Escribe tu nombre y selecciona:</p>
  <input id="nombre" placeholder="Tu nombre">
  <select id="genero">
    <option value="azul">NiÃ±o ðŸ‘¦</option>
    <option value="rosado">NiÃ±a ðŸ‘§</option>
  </select><br><br>
  <button onclick="empezar()">Comenzar</button>
</div>

<div id="juego" class="pantalla">
  <h2 id="saludo"></h2>
  <p>Escribe dos nÃºmeros para sumar:</p>
  <input id="num1" type="number"> +
  <input id="num2" type="number">
  <button onclick="iniciarSuma()">Sumar</button>

  <div class="contenedor">
    <div>
      <h3>Grupo mayor</h3>
      <div id="mayor" class="grupo"></div>
    </div>
    <div>
      <h3>Grupo menor</h3>
      <div id="menor" class="grupo"></div>
    </div>
  </div>

  <div class="globo-con-numero">
    <div id="globo">ðŸŽˆ</div>
    <div id="numeroGlobo">0</div>
  </div>

  <h2 id="resultado"></h2>
  <div id="cuentaFinal"></div>
  <div id="medallaFinal"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
<script>
function hablarAbuelita(frases, pausa = 3000) {
  let i = 0;
  function decirSiguiente() {
    if (i < frases.length) {
      const voz = new SpeechSynthesisUtterance(frases[i]);
      voz.lang = 'es-ES';
      voz.rate = 0.85;
      speechSynthesis.speak(voz);
      i++;
      setTimeout(decirSiguiente, pausa);
    }
  }
  decirSiguiente();
}

function dibujarOsitos(cantidad){
  return "ðŸ§¸".repeat(cantidad);
}

function empezar(){
  const nombre = document.getElementById("nombre").value;
  const genero = document.getElementById("genero").value;
  document.getElementById("inicio").style.display="none";
  document.getElementById("juego").style.display="block";
  document.getElementById("saludo").textContent = "Hola " + nombre + ", vamos a jugar!";

  if(genero==="azul"){ document.body.style.background="#cce5ff"; }
  else { document.body.style.background="#ffd6e7"; }

  hablarAbuelita([
    "Vamos a jugar sumando...",
    "Por favor escribe dos nÃºmeros.",
    "Cuando estÃ©s listo, haz clic en sumar."
  ]);
}

function playNote(frequency, duration=0.4){
  const ctx = new (window.AudioContext || window.webkitAudioContext)();
  const osc = ctx.createOscillator();
  const gain = ctx.createGain();
  osc.type = "sine";
  osc.frequency.value = frequency;
  osc.connect(gain);
  gain.connect(ctx.destination);
  osc.start();
  gain.gain.setValueAtTime(0.2, ctx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + duration);
  osc.stop(ctx.currentTime + duration);
}

const escala = [261.63, 293.66, 329.63, 349.23, 392.00, 440.00, 493.88]; 
let pasoMusical = 0;
function playStepSound(){
  playNote(escala[pasoMusical % escala.length]);
  pasoMusical++;
}
function playFinalChord(){
  playNote(261.63, 1);
  playNote(329.63, 1);
  playNote(392.00, 1);
}

function iniciarSuma(){
  let a = parseInt(document.getElementById("num1").value);
  let b = parseInt(document.getElementById("num2").value);
  if(isNaN(a)||isNaN(b)) return;

  let mayor = Math.max(a,b);
  let menor = Math.min(a,b);

  let mayorDiv = document.getElementById("mayor");
  let menorDiv = document.getElementById("menor");
  let resultado = document.getElementById("resultado");
  let globo = document.getElementById("globo");
  let numeroGlobo = document.getElementById("numeroGlobo");
  let cuentaFinal = document.getElementById("cuentaFinal");
  let medallaFinal = document.getElementById("medallaFinal");

  mayorDiv.textContent = dibujarOsitos(mayor);
  menorDiv.textContent = dibujarOsitos(menor);
  resultado.textContent = "";
  cuentaFinal.innerHTML = "";
  medallaFinal.innerHTML = "";
  globo.style.width="100px"; globo.style.height="100px";
  globo.textContent="ðŸŽˆ";
  globo.style.background="red";
  numeroGlobo.textContent = mayor;

  const frases = [
    `Si tenemos ${mayor} ositos y le sumamos ${menor} ositos...`,
    "Para que te sea mÃ¡s fÃ¡cil, mantÃ©n en tu mente el nÃºmero mÃ¡s grande.",
    `Vamos a ver... tengo ${mayor} en la mente y le voy a sumar ${menor}.`,
    `SerÃ­an ${Array.from({length: menor}, (_, i) => mayor + i + 1).join(', ')}...`,
    `AÃ±adimos ${menor} ositos a los ${mayor} que tenÃ­amos.`,
    "Eso que darÃ­a asÃ­ como te muestro acÃ¡ abajo...",
    "Â¡Bravo, campeÃ³n! Has sumado con alegrÃ­a y concentraciÃ³n.",
    "Sigamos. Coloca dos nÃºmeros nuevamente."
  ];

  hablarAbuelita(frases, 3000);

  setTimeout(() => {
    let pasos = menor;
    let total = mayor;
    let intervalo = setInterval(() => {
      if (pasos > 0) {
        pasos--;
        menorDiv.textContent = dibujarOsitos(pasos);
        total++;
        mayorDiv.textContent = dibujarOsitos(total);

        let size = 100 + (menor - pasos) * 25;
        globo.style.width = size + "px";
        globo.style.height = size + "px";
        numeroGlobo.textContent = total;
        playStepSound();
      } else {
        clearInterval(intervalo);
              resultado.textContent = `Resultado: ${a + b} ositos`;
        confetti({ particleCount: 200, spread: 80, origin: { y: 0.6 } });
        globo.style.background = "transparent";
        globo.textContent = "ðŸ’¥";
        playFinalChord();

        cuentaFinal.innerHTML = `
          <div class="cuenta">
            ${a}<br>
            + ${b}<br>
            <div class="linea"></div>
            ${a + b}
          </div>
        `;

        medallaFinal.innerHTML = `<div class="medalla">ðŸ¥‡</div>`;
      }
    }, 4000); // velocidad pausada para cada osito
  }, frases.length * 3000); // esperar a que termine la narraciÃ³n
}
</script>
</body>
</html>
